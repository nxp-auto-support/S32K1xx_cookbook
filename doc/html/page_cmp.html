<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Comparator (CMP)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="s32k1xx_cookbook_logo.jpg"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">S32K1xx Series Cookbook</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Comparator (CMP) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Description </h2>
<p>The CMP is initialized to compare an analogic input with a with a software configurable reference. When the input is higher than the reference, the LED changes of color.<br />
 Before starting please connect PTC14(output from the potentiometer) to PTA0.<br />
 If using the S32K148 EVB, please connect the PTC28 to the PTA0.<br />
 </p><div class="image">
<img src="Diagram_CMP_project.png" alt="Diagram_CMP_project.png" width="850" height="400"/>
</div>
<h2>Design </h2>
<ul>
<li>Disable Watchdog<br />
</li>
<li>Initialize port pins:<br />
</li>
<li>System clocks: Initialize SOSC for 8 MHz, sysclk for 80 MHz, RUN mode for 80 MHz<br />
</li>
<li>Initiate ACMP with the desired reference (Vref = 3.3*(vosel/255))<br />
</li>
<li>Enable interrupt<br />
</li>
<li><p class="startli">Define interrupt routine:<br />
</p><ul>
<li>LED turns green when the Vin is higher than Vref<br />
</li>
<li>LED turns red when the Vin is lower than Vref<br />
<br />
<h2>Pins definitions: </h2>
</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function  </th><th class="markdownTableHeadNone">S32K116  </th><th class="markdownTableHeadNone">S32K118  </th><th class="markdownTableHeadNone">S32K142  </th><th class="markdownTableHeadNone">S32K144  </th><th class="markdownTableHeadNone">S32K146  </th><th class="markdownTableHeadNone">S32K148   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CMP0_OUT  </td><td class="markdownTableBodyNone">PTA4*  </td><td class="markdownTableBodyNone">PTA4*  </td><td class="markdownTableBodyNone">PTE3  </td><td class="markdownTableBodyNone">PTE3  </td><td class="markdownTableBodyNone">PTE3  </td><td class="markdownTableBodyNone">PTE3   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">CMP0_IN  </td><td class="markdownTableBodyNone">PTA0  </td><td class="markdownTableBodyNone">PTA0  </td><td class="markdownTableBodyNone">PTA0  </td><td class="markdownTableBodyNone">PTA0  </td><td class="markdownTableBodyNone">PTA0  </td><td class="markdownTableBodyNone">PTA0   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RED_LED  </td><td class="markdownTableBodyNone">PTD16  </td><td class="markdownTableBodyNone">PTD16  </td><td class="markdownTableBodyNone">PTD15  </td><td class="markdownTableBodyNone">PTD15  </td><td class="markdownTableBodyNone">PTD15  </td><td class="markdownTableBodyNone">PTE21   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">GREEN_LED  </td><td class="markdownTableBodyNone">PTD15  </td><td class="markdownTableBodyNone">PTD15  </td><td class="markdownTableBodyNone">PTD16  </td><td class="markdownTableBodyNone">PTD16  </td><td class="markdownTableBodyNone">PTD16  </td><td class="markdownTableBodyNone">PTE22   </td></tr>
</table>
</li>
</ul>
<p>Note: If debugging S32K11x EVB <br />
PTA4 is used for JTAG Test Mode Select/Serial Wire Debug Data I/O. Please comment line 29 in main.c:<br />
PORTA-&gt;PCR[4] = PORT_PCR_MUX(1);<br />
<br />
</p><h2>Driver Functions: </h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function  </th><th class="markdownTableHeadNone">Driver   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="acmp_8h.html#a88cd5339b55e788214e9fb3c4137b3a4">ACMP_Init</a>  </td><td class="markdownTableBodyNone">acmp   </td></tr>
</table>
<h2>main.c </h2>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;device_registers.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="clocks__and__modes_8h.html">clocks_and_modes.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="acmp_8h.html">acmp.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define PTD15 (15)</span></div><div class="line"><span class="preprocessor">#define PTD16 (16)</span></div><div class="line"><span class="keywordtype">void</span> PORT_init (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  PCC-&gt;PCCn[PCC_PORTA_INDEX] = PCC_PCCn_CGC_MASK;   <span class="comment">/* Enable clock for PORT A  */</span></div><div class="line">  PORTA-&gt;PCR[0] = PORT_PCR_MUX(0);  <span class="comment">/* Port A0: default, Comparator Input Signal*/</span></div><div class="line"></div><div class="line">    PCC-&gt;PCCn[PCC_PORTD_INDEX] = PCC_PCCn_CGC_MASK;     <span class="comment">/* Enable clock for PORT D  */</span></div><div class="line">  PORTD-&gt;PCR[PTD15] = PORT_PCR_MUX(1);  <span class="comment">/* Port D15: MUX = GPIO */</span></div><div class="line">  PORTD-&gt;PCR[PTD16] = PORT_PCR_MUX(1);  <span class="comment">/* Port D16: MUX = GPIO */</span></div><div class="line"></div><div class="line">  PTD-&gt;PDDR |= 1&lt;&lt;PTD15     <span class="comment">/* Port D15: Data Direction = output */</span></div><div class="line">              |1&lt;&lt;PTD16;    <span class="comment">/* Port D16: Data Direction = output */</span></div><div class="line"></div><div class="line">  PTD-&gt;PSOR |= 1&lt;&lt;PTD15     <span class="comment">/* Turn-Off RGB led */</span></div><div class="line">              |1&lt;&lt;PTD16;</div><div class="line"></div><div class="line">  PCC-&gt;PCCn[PCC_PORTE_INDEX] = PCC_PCCn_CGC_MASK;   <span class="comment">/* Enable clock for PORT D  */</span></div><div class="line">  PORTE-&gt;PCR[3] = PORT_PCR_MUX(7);  <span class="comment">/* Port E7: MUX = ALT7, Comparator Output trigger */</span></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> WDOG_disable (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  WDOG-&gt;CNT=0xD928C520;     <span class="comment">/* Unlock watchdog      */</span></div><div class="line">  WDOG-&gt;TOVAL=0x0000FFFF;   <span class="comment">/* Maximum timeout value    */</span></div><div class="line">  WDOG-&gt;CS = 0x00002100;    <span class="comment">/* Disable watchdog         */</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> Enable_Interrupt(uint8_t vector_number)</div><div class="line">{</div><div class="line">  S32_NVIC-&gt;ISER[(uint32_t)(vector_number) &gt;&gt; 5U] = (uint32_t)(1U &lt;&lt; ((uint32_t)(vector_number) &amp; (uint32_t)0x1FU));</div><div class="line">  S32_NVIC-&gt;ICPR[(uint32_t)(vector_number) &gt;&gt; 5U] = (uint32_t)(1U &lt;&lt; ((uint32_t)(vector_number) &amp; (uint32_t)0x1FU));</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    WDOG_disable();         <span class="comment">/* Disable WDOG */</span></div><div class="line">    PORT_init();            <span class="comment">/* Configure ports */</span></div><div class="line">    <a class="code" href="clocks__and__modes_8c.html#a2f05a0e5aa290fba55984156198f14a2">SOSC_init_8MHz</a>();       <span class="comment">/* Initialize system oscilator for 8 MHz xtal */</span></div><div class="line">    <a class="code" href="clocks__and__modes_8c.html#a5b337515ef6255432800f7793441527c">SPLL_init_160MHz</a>();     <span class="comment">/* Initialize SPLL to 160 MHz with 8 MHz SOSC */</span></div><div class="line">    <a class="code" href="clocks__and__modes_8c.html#aa234261bbd2c76d65303e209757dc19b">NormalRUNmode_80MHz</a>();  <span class="comment">/* Init clocks: 80 MHz sysclk &amp; core, 40 MHz bus, 20 MHz flash */</span></div><div class="line"></div><div class="line">    <a class="code" href="acmp_8c.html#a88cd5339b55e788214e9fb3c4137b3a4">ACMP_Init</a>(127);                 <span class="comment">/* Initialize CMP0 */</span></div><div class="line">    Enable_Interrupt(CMP0_IRQn);    <span class="comment">/* Enable CMP0 interrupt */</span></div><div class="line"></div><div class="line">    <span class="keywordflow">for</span>(;;)</div><div class="line">    {</div><div class="line"></div><div class="line"></div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> CMP0_IRQHandler (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span>(CMP0-&gt;C0 &amp; CMP_C0_CFR_MASK)</div><div class="line">    {</div><div class="line">        <span class="comment">/* A rising edge on COUT has occurred */</span></div><div class="line">        CMP0-&gt;C0 |= CMP_C0_CFR_MASK;    <span class="comment">/* CFR is cleared by writing 1 to it. */</span></div><div class="line">        PTD-&gt;PSOR |= 1&lt;&lt;15;     <span class="comment">/* Turn-Off RED led */</span></div><div class="line">        PTD-&gt;PCOR |= 1&lt;&lt;16;     <span class="comment">/* Turn-On GREEN led */</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(CMP0-&gt;C0 &amp; CMP_C0_CFF_MASK)</div><div class="line">    {</div><div class="line">        <span class="comment">/* A falling edge on COUT has occurred */</span></div><div class="line">        CMP0-&gt;C0 |= CMP_C0_CFF_MASK;    <span class="comment">/* CFF is cleared by writing 1 to it. */</span></div><div class="line">        PTD-&gt;PSOR |= 1&lt;&lt;16;     <span class="comment">/* Turn-Off GREEN led */</span></div><div class="line">        PTD-&gt;PCOR |= 1&lt;&lt;15;     <span class="comment">/* Turn-On RED led */</span></div><div class="line">    }</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
